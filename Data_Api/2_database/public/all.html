<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <title>Server side</title>
  </head>
  <body>
    <h1>Data Selfie App</h1>
    <!-- <a href="index.html">hello</a> | <a href="goodbye/index.html">goodbye</a> -->
    <button id="btn_get">Get all data</button>

    <div id="all_data"></div>
    <script>
      document.getElementById("btn_get").addEventListener("click", async () => {
        try {
          const options = {
            method: "GET",
          };
          const response = await fetch("/api", options);
          const result = await response.json();
          console.log(result);

          for (item of result) {
            const root = document.createElement("div");
            const concept = document.createElement("div");
            const geo = document.createElement("div");
            const date = document.createElement("div");
            const dateString = new Date(item.timestamp).toLocaleString();

            concept.textContent = `concept: ${item.concept}`;
            geo.textContent = `${item.lat}, ${item.lon}`;
            date.textContent = dateString;

            root.append(concept, geo, date);
            document.body.append(root);
          }
        } catch (error) {
          console.log(error);
          document.getElementById("all_data").textContent = "An error occured.";
        }
      });
    </script>
  </body>
</html>
